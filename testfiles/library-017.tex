\documentclass{article}

\input{regression-test}

\UseTblrLibrary{tikz}
\usetikzlibrary{patterns}
\setlength{\parindent}{0pt}

\begin{document}

\START
\hrule\bigskip

\BEGINTEST{tikz: multispan cells in a short table}
\begin{tblrtikzbefore}
  \fill[pattern color=lightgray,pattern=bricks]
    (table.north east) rectangle (table.south west);
\end{tblrtikzbefore}%
\begin{tblr}{
    hlines, vlines,
    colspec={ l l l l },
    hline{1} = {2pt},
    vline{1} = {1}{2pt},
    vline{2} = {2}{-}{1pt},
    hline{Z} = {2pt},
    cell{1}{1} = {r=2}{c},
    cell{1}{3} = {c=3}{c},
    cell{2}{2} = {r=2, c=2}{c}
}
    1 & 2       & 3 &   &   \\
      & foo bar &   & 4 & 5 \\
    6 &         &   & 7 & 8
\end{tblr}%
\begin{tblrtikzafter}
  \begin{scope}[blend mode=darken]
    \fill[yellow7] (1-1.north west) rectangle (1-1.south east);
    \fill[red7] (1-3.north west) rectangle (1-3.south east);
    \fill[blue7] (2-2.north west) rectangle (2-2.south east);
    \fill[azure7] (3-5.north west) rectangle (3-5.south east);
  \end{scope}
\end{tblrtikzafter}
\ENDTEST

\bigskip\hrule\bigskip

\BEGINTEST{tikz: multispan cells in a tall table}
\begin{table}[htp]
\begin{tblrtikzbefore}
  \fill[pattern color=lightgray,pattern=checkerboard]
    (table.north east) rectangle (table.south west);
\end{tblrtikzbefore}%
\begin{talltblr}[caption=Tall]{|c|c|c|[2pt]|c|c|}
\hline
 \SetCell[r=2]{c} 2 Rows
     & \SetCell[c=2]{c} 2 Columns
           &     & \SetCell[r=2,c=2]{c} 2 Rows 2 Columns & \\
\hline
     & 2-2 & 2-3 &     &     \\
\hline\hline[1pt]
 3-1 & 3-2 & 3-3 & 3-4 & 3-5 \\
\cline[2pt]{1-2}
\cline[1pt]{3}
\cline[3pt]{4-5}
\end{talltblr}%
\begin{tblrtikzafter}
  \begin{scope}[blend mode=multiply]
    \fill[yellow7] (1-1.north west) rectangle (1-1.south east);
    \fill[red7] (1-2.north west) rectangle (1-2.south east);
    \fill[blue7] (1-4.north west) rectangle (1-4.south east);
    \fill[green7] (3-3.north west) rectangle (3-3.south east);
    \fill[azure7] (3-5.north west) rectangle (3-5.south east);
  \end{scope}
\end{tblrtikzafter}
\end{table}
\ENDTEST

\end{document}
